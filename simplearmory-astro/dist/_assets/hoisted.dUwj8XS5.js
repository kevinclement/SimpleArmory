import{i as h,s as w,p as f,b as E,g as C}from"./Nav.astro_astro_type_script_index_0_lang.CT0JDFuw.js";const y=new Map;async function $(e,t,n){if(!e||!t||!n)throw new Error("Region, realm, and character are required");const a=`${e}_${t}_${n}`;if(y.has(a))return y.get(a);try{const o=`/api/toys?region=${encodeURIComponent(e)}&realm=${encodeURIComponent(t)}&character=${encodeURIComponent(n)}`,r=await fetch(o);if(!r.ok)throw new Error(`Failed to fetch toys: ${r.status} ${r.statusText}`);const s=await r.json();return y.set(a,s),s}catch(o){throw console.error("Error fetching toys:",o),o}}document.addEventListener("DOMContentLoaded",()=>{h();const e=C();u(e),w(t=>{u(t)}),window.ga&&window.ga("send","pageview","Toys")});async function u(e){if(!e.region||!e.realm||!e.character)return;const t=document.getElementById("loading-indicator"),n=document.getElementById("toys-error"),a=document.getElementById("toys-categories");t&&(t.style.display="block"),n&&(n.style.display="none");try{const o=await $(e.region,e.realm,e.character);t&&(t.style.display="none"),o&&(b(o.collected,o.possible),I(o,a))}catch(o){console.error("Error loading toys:",o),t&&(t.style.display="none"),n&&(n.style.display="block")}}function b(e,t){const n=document.querySelector(".progress-bar"),a=n?.querySelector("span");if(!n||!a)return;const o=f(e,t),r=E(e,t);n.style.width=o+"%",n.setAttribute("aria-valuenow",o.toString()),a.textContent=r}function I(e,t){if(!t||!e||!e.categories)return;t.innerHTML="";const n=document.createDocumentFragment();e.categories.forEach(a=>{const o=document.createElement("div");o.className="category-container";const r=document.createElement("h3");r.className="category-header",r.textContent=a.name,o.appendChild(r),a.subcats.forEach(s=>{const d=document.createElement("div");d.className="subcategory-container";const g=document.createElement("h4");g.className="subcategory-header",g.textContent=s.name,d.appendChild(g);const p=document.createElement("div");p.className="toys-grid",s.toys&&s.toys.length>0&&s.toys.forEach(c=>{const i=document.createElement("div");i.className=`toy-item ${c.collected?"collected":"not-collected"}`;const l=document.createElement("a");l.href=c.id?`//www.wowhead.com/item=${c.id}`:"#",l.target="_blank";const m=document.createElement("img");m.src=c.icon?`//wow.zamimg.com/images/wow/icons/small/${c.icon}.jpg`:"",m.alt=c.name,m.title=c.name,l.appendChild(m),i.appendChild(l),i.dataset.toyId=c.id.toString(),i.dataset.toyName=c.name,i.dataset.toyCollected=c.collected.toString(),p.appendChild(i)}),d.appendChild(p),o.appendChild(d)}),n.appendChild(o)}),t.appendChild(n),window.WH&&window.WH.Tooltip&&window.WH.Tooltip.refresh()}
