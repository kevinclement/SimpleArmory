import{g as E,a as D}from"./Nav.astro_astro_type_script_index_0_lang.CT0JDFuw.js";import{g as C}from"./achievements.bdcs346B.js";let u={},d=[],a=null,x=0,L=0,M,y,g,p,b;document.addEventListener("DOMContentLoaded",async()=>{try{window.ga&&window.ga("send","pageview","Calendar"),M=document.getElementById("prev-month"),y=document.getElementById("next-month"),g=document.getElementById("month-select"),p=document.getElementById("calendar-container"),b=document.getElementById("progress-container"),M.addEventListener("click",k),y.addEventListener("click",A),g.addEventListener("change",v);const e=E();if(!e||!e.region||!e.realm||!e.character){m("Missing character information");return}document.title=D(e.character,"Calendar");const t=await C(e.region,e.realm,e.character);if(!t){m("Failed to load achievements data");return}F(t,e.character)}catch(e){console.error("Error loading calendar:",e),m(e.message||"Failed to load calendar")}});function F(e,t){u=T(e),d=B(u),H(d),a=d[d.length-1],g.value=d.length-1,w(),v()}function T(e){const t={};return Object.keys(e).forEach(r=>{let o=e[r];o.categories&&o.categories.forEach(f=>{f.subcats.forEach(l=>{l.achievements.forEach(n=>{if(n.completed){let c=new Date(n.completed),s=c.getFullYear(),h=c.getMonth()+1;var i=""+s+(h<10?"0":"")+h;t[i]||(t[i]=new Array(31),t[i].hasAchievements=!0,t[i].total=0,t[i].points=0),t[i][c.getDate()]||(t[i][c.getDate()]=[]),t[i][c.getDate()].push(n),t[i].total++,t[i].points+=n.points}})})})}),t}function B(e){let t=["","January","February","March","April","May","June","July","August","September","October","November","December"],r=new Date,o=!1,f=[],l=0;for(let s=2008;s<=r.getFullYear();s++)for(var n=1;n<=12;n++){var i=""+s+(n<10?"0":"")+n,c=s===r.getFullYear()&&n===r.getMonth()+1;if(!(!o&&(!e[i]||!e[i].hasAchievements))&&(o=!0,f.push({value:i,text:t[n]+" "+s,index:l++,year:s,month:n}),c))break}return f}function H(e){g.innerHTML="",e.forEach((t,r)=>{const o=document.createElement("option");o.value=r,o.textContent=t.text,g.appendChild(o)})}function I(e,t){let r='<table class="calendar">',o;for(var f=t.charAt(0).toUpperCase()+t.slice(1),l=1;l<=31&&(o=new Date(e.year,e.month-1,l),o.getDate()===l);l++){(l===1||o.getDay()===0)&&(r+="<tr>"),l===1&&o.getDay()>0&&(r+='<td colspan="'+o.getDay()+'" class="dayspacer"></td>');let n=u[e.value],i=0;if(n&&n[l]&&n[l].forEach(c=>{i+=c.points}),i>0?r+="<td>"+l+`<small> - ${i} points </small>`:r+="<td>"+l,n&&n[l]){let c=n[l];c.sort((s,h)=>s.completed===h.completed?parseInt(s.id,10)<parseInt(h.id,10)?-1:1:s.completed<h.completed?-1:1),r+="<div>",c.forEach(s=>{r+='<a target="_blank" href="https://www.wowhead.com/achievement='+s.id+'" rel="who='+f+"&amp;when="+s.completed+'"><img src="//wow.zamimg.com/images/wow/icons/medium/'+s.icon.toLowerCase()+'.jpg" width="36" height="36" border="0"></a>'}),r+="</div>"}r+="</td>",o.getDay()===6&&(r+="</tr>")}return o.getDay()<6&&(r+='<td colspan="'+(6-o.getDay())+'" class="dayspacer"></td>'),r+="</tr>",r+="</table>",r}function k(){a&&a.index>0&&(a=d[a.index-1],g.value=a.index,w(),v())}function A(){a&&a.index<d.length-1&&(a=d[a.index+1],g.value=a.index,w(),v())}function v(){const e=parseInt(g.value,10);a=d[e],w(),O(),S()}function w(){a&&(M.disabled=a.index<=0,y.disabled=a.index>=d.length-1)}function O(){if(!a||!p)return;const e=E();if(!e||!e.character)return;const t=I(a,e.character);p.innerHTML=t}function S(){if(!a||!b)return;x=a&&u&&u[a.value]?u[a.value].total:0,L=a&&u&&u[a.value]?u[a.value].points:0;const e=`
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="progress-text">${x} (${L} points)</div>
    `;b.innerHTML=e}function m(e){p&&(p.innerHTML=`
        <div class="error">
          <i class="glyphicon glyphicon-exclamation-sign"></i>
          <p>${e}</p>
        </div>
      `)}document.addEventListener("router:update",async()=>{const e=E();if(window.location.hash.startsWith("#/calendar")&&e.region&&e.realm&&e.character){document.title=D(e.character,"Calendar");try{p&&(p.innerHTML=`
            <div class="loading">
              <div class="spinner"></div>
              <div class="loading-text">Loading...</div>
            </div>
          `);const t=await C(e.region,e.realm,e.character);if(!t){m("Failed to load achievements data");return}F(t,e.character)}catch(t){console.error("Error loading calendar:",t),m(t.message||"Failed to load calendar")}}});
