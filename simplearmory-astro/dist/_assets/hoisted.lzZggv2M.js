import{g as h,p as v,b as y}from"./Nav.astro_astro_type_script_index_0_lang.CT0JDFuw.js";const m=new Map;async function u(e,t,o){if(!e||!t||!o)throw new Error("Region, realm, and character are required");const n=`${e}_${t}_${o}`;if(m.has(n))return m.get(n);try{const r=`/api/heirlooms?region=${encodeURIComponent(e)}&realm=${encodeURIComponent(t)}&character=${encodeURIComponent(o)}`,a=await fetch(r);if(!a.ok)throw new Error(`Failed to fetch heirlooms: ${a.status} ${a.statusText}`);const i=await a.json();return m.set(n,i),i}catch(r){throw console.error("Error fetching heirlooms:",r),r}}document.addEventListener("DOMContentLoaded",async()=>{try{window.ga&&window.ga("send","pageview","Heirlooms");const e=h();if(!e||!e.region||!e.realm||!e.character){l("Missing character information");return}document.title=getTitle(e.character,"Heirlooms");const t=await u(e.region,e.realm,e.character);if(!t){l("Failed to load heirlooms data");return}g(t),f(t)}catch(e){console.error("Error loading heirlooms:",e),l(e.message||"Failed to load heirlooms")}});function g(e){const t=document.getElementById("progress-container");if(t){const o=`
        <div class="progress">
          <div class="progress-bar" role="progressbar" style="width: ${v(e.collected,e.possible)}%;" aria-valuenow="${e.collected}" aria-valuemin="0" aria-valuemax="${e.possible}"></div>
        </div>
        <div class="progress-text">${y(e.collected,e.possible)}</div>
      `;t.innerHTML=o}}function f(e){const t=document.getElementById("heirlooms-container");if(t){t.innerHTML="";for(const o of e.categories){const n=document.createElement("div");n.className="category";const r=document.createElement("h3");r.textContent=o.name,n.appendChild(r);for(const a of o.subcats){const i=document.createElement("div");i.className="subcategory";const p=document.createElement("h4");p.textContent=a.name,i.appendChild(p);const d=document.createElement("div");d.className="items";for(const s of a.heirlooms){const c=document.createElement("a");c.className=`item${s.collected?" collected":""}`,c.href=s.source?.link||"#",c.target="_blank",c.rel="noopener noreferrer";const w=`
            <div class="tooltip-content">
              <div class="tooltip-title">${s.name}</div>
              <div class="tooltip-description">${s.description||""}</div>
              ${s.source?`<div class="tooltip-source">Source: ${s.source.text}</div>`:""}
            </div>
          `;c.setAttribute("data-tooltip",w),c.style.backgroundImage=`url(https://wow.zamimg.com/images/wow/icons/large/${s.icon}.jpg)`,d.appendChild(c)}i.appendChild(d),n.appendChild(i)}t.appendChild(n)}E()}}function l(e){const t=document.getElementById("heirlooms-container");t&&(t.innerHTML=`
        <div class="error">
          <i class="glyphicon glyphicon-exclamation-sign"></i>
          <p>${e}</p>
        </div>
      `)}function E(){document.querySelectorAll(".item[data-tooltip]").forEach(t=>{t.addEventListener("mouseenter",function(){const o=this.getAttribute("data-tooltip");$(this,o)}),t.addEventListener("mouseleave",function(){C()})})}function $(e,t){let o=document.getElementById("item-tooltip");o||(o=document.createElement("div"),o.id="item-tooltip",o.className="tooltip",document.body.appendChild(o)),o.innerHTML=t;const n=e.getBoundingClientRect(),r=o.getBoundingClientRect();let a=n.top-r.height-10,i=n.left+n.width/2-r.width/2;a<0&&(a=n.bottom+10),i<0&&(i=0),i+r.width>window.innerWidth&&(i=window.innerWidth-r.width),o.style.top=`${a+window.scrollY}px`,o.style.left=`${i}px`,o.style.display="block"}function C(){const e=document.getElementById("item-tooltip");e&&(e.style.display="none")}document.addEventListener("router:update",async()=>{const e=h();if(window.location.hash.startsWith("#/heirlooms")&&e.region&&e.realm&&e.character){document.title=getTitle(e.character,"Heirlooms");try{const t=await u(e.region,e.realm,e.character);if(!t){l("Failed to load heirlooms data");return}g(t),f(t)}catch(t){console.error("Error loading heirlooms:",t),l(t.message||"Failed to load heirlooms")}}});
