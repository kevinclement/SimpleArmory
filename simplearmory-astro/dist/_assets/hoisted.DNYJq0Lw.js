import{i as w,s as f,p as y,b as C,g as E}from"./Nav.astro_astro_type_script_index_0_lang.CT0JDFuw.js";const u=new Map;async function $(e,n,o){if(!e||!n||!o)throw new Error("Region, realm, and character are required");const a=`${e}_${n}_${o}`;if(u.has(a))return u.get(a);try{const t=`/api/companions?region=${encodeURIComponent(e)}&realm=${encodeURIComponent(n)}&character=${encodeURIComponent(o)}`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch companions: ${r.status} ${r.statusText}`);const i=await r.json();return u.set(a,i),i}catch(t){throw console.error("Error fetching companions:",t),t}}document.addEventListener("DOMContentLoaded",()=>{w();const e=E();h(e),f(n=>{h(n)}),window.ga&&window.ga("send","pageview","Companions")});async function h(e){if(!e.region||!e.realm||!e.character)return;const n=document.getElementById("loading-indicator"),o=document.getElementById("companions-error"),a=document.getElementById("companions-categories");n&&(n.style.display="block"),o&&(o.style.display="none");try{const t=await $(e.region,e.realm,e.character);n&&(n.style.display="none"),t&&(b(t.collected,t.possible),I(t,a))}catch(t){console.error("Error loading companions:",t),n&&(n.style.display="none"),o&&(o.style.display="block")}}function b(e,n){const o=document.querySelector(".progress-bar"),a=o?.querySelector("span");if(!o||!a)return;const t=y(e,n),r=C(e,n);o.style.width=t+"%",o.setAttribute("aria-valuenow",t.toString()),a.textContent=r}function I(e,n){if(!n||!e||!e.categories)return;n.innerHTML="";const o=document.createDocumentFragment();e.categories.forEach(a=>{const t=document.createElement("div");t.className="category-container";const r=document.createElement("h3");r.className="category-header",r.textContent=a.name,t.appendChild(r),a.subcats.forEach(i=>{const d=document.createElement("div");d.className="subcategory-container";const p=document.createElement("h4");p.className="subcategory-header",p.textContent=i.name,d.appendChild(p);const g=document.createElement("div");g.className="companions-grid",i.companions&&i.companions.length>0&&i.companions.forEach(c=>{const s=document.createElement("div");s.className=`companion-item ${c.collected?"collected":"not-collected"}`;const m=document.createElement("a");m.href=c.id?`//www.wowhead.com/item=${c.id}`:"#",m.target="_blank";const l=document.createElement("img");l.src=c.icon?`//wow.zamimg.com/images/wow/icons/small/${c.icon}.jpg`:"",l.alt=c.name,l.title=c.name,m.appendChild(l),s.appendChild(m),s.dataset.companionId=c.id.toString(),s.dataset.companionName=c.name,s.dataset.companionCollected=c.collected.toString(),g.appendChild(s)}),d.appendChild(g),t.appendChild(d)}),o.appendChild(t)}),n.appendChild(o),window.WH&&window.WH.Tooltip&&window.WH.Tooltip.refresh()}
