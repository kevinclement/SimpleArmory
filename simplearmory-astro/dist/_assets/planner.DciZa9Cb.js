const p=new Map;async function f(t,s,o,i){if(!t)throw new Error("Mount data is required");const r=`${s}_${o}_${i}`;if(p.has(r))return p.get(r);try{const c=`/api/planner?region=${encodeURIComponent(s)}&realm=${encodeURIComponent(o)}&character=${encodeURIComponent(i)}`,n=await fetch(c);if(!n.ok)throw new Error(`Failed to fetch planner data: ${n.status} ${n.statusText}`);const e=await n.json(),a=l(e,t);return p.set(r,a),a}catch(c){return console.error("Error fetching planner data:",c),d(t)}}function l(t,s){return!t||!t.steps?[]:t.steps}function d(t){if(t.collected===t.possible)return[];const s=[],o=[];t.categories.forEach(e=>{e.subcats.forEach(a=>{a.mounts.forEach(u=>{u.collected||o.push({mount:u.name,category:e.name,subcat:a.name,icon:u.icon,itemId:u.id,source:u.source})})})});const i=o.filter(e=>e.source&&(e.source.text.toLowerCase().includes("dungeon")||e.source.text.toLowerCase().includes("raid"))),r=o.filter(e=>e.source&&e.source.text.toLowerCase().includes("reputation")),c=o.filter(e=>e.source&&e.source.text.toLowerCase().includes("drops")),n=o.filter(e=>e.source&&(e.source.text.toLowerCase().includes("vendor")||e.source.text.toLowerCase().includes("purchase")));return i.length>0&&s.push({title:"Farm Dungeon & Raid Mounts",notes:"Run these instances for a chance at rare mount drops",bosses:i.map(e=>({name:e.source&&e.source.text.split(" from ")[1]||"Boss",mount:e.mount,icon:e.icon,itemId:e.itemId,epic:e.category==="Epic",note:"Reset and repeat for better chances"}))}),c.length>0&&s.push({title:"Hunt Rare Spawns",notes:"These mounts drop from rare spawns in the world",bosses:c.map(e=>({name:e.source&&e.source.text.split(" from ")[1]||"Rare Spawn",mount:e.mount,icon:e.icon,itemId:e.itemId,epic:!1,note:"Check spawn timers and locations online"}))}),r.length>0&&s.push({title:"Earn Reputation",notes:"Gain reputation with these factions to purchase mounts",bosses:r.map(e=>({name:e.source&&e.source.text.split(" with ")[1]||"Faction",mount:e.mount,icon:e.icon,itemId:e.itemId,epic:!1,note:"Complete daily quests and turn in items for reputation"}))}),n.length>0&&s.push({title:"Purchase from Vendors",notes:"These mounts can be purchased directly",bosses:n.map(e=>({name:e.source&&e.source.text.split(" from ")[1]||"Vendor",mount:e.mount,icon:e.icon,itemId:e.itemId,epic:!1,note:"May require gold or specific currencies"}))}),t.isAlliance!==void 0&&s.unshift({title:"Capital",capital:!0,notes:"Start your mount hunt from your faction's capital city",hearth:!1}),s}export{f as getPlannerSteps};
