import{_ as T}from"./preload-helper.CLcXU_4U.js";import{i as v,s as H,n as I,p as $,b as B,g as M}from"./Nav.astro_astro_type_script_index_0_lang.CT0JDFuw.js";const b=new Map;async function x(e,t,a){if(!e||!t||!a)throw new Error("Region, realm, and character are required");const n=`${e}_${t}_${a}`;if(b.has(n))return b.get(n);try{const l=`/api/mounts?region=${encodeURIComponent(e)}&realm=${encodeURIComponent(t)}&character=${encodeURIComponent(a)}`,o=await fetch(l);if(!o.ok)throw new Error(`Failed to fetch mounts: ${o.status} ${o.statusText}`);const c=await o.json();return b.set(n,c),c}catch(l){throw console.error("Error fetching mounts:",l),l}}document.addEventListener("DOMContentLoaded",()=>{v();const e=M();L(e),N(e),H(t=>{N(t)}),window.ga&&window.ga("send","pageview","Mounts")});function L(e){const t=document.getElementById("planner-toggle");t&&t.addEventListener("change",a=>{const n=a.target.checked;n?I("collectable/mounts/planner",e.region,e.realm,e.character):I("collectable/mounts/",e.region,e.realm,e.character);const l=document.getElementById("planner-view"),o=document.getElementById("mounts-categories");l&&(l.style.display=n?"block":"none"),o&&(o.style.display=n?"none":"block")})}async function N(e){if(!e.region||!e.realm||!e.character)return;const t=document.getElementById("loading-indicator"),a=document.getElementById("mounts-error"),n=document.getElementById("mounts-categories"),l=document.getElementById("planner-view");t&&(t.style.display="block"),a&&(a.style.display="none");try{const o=await x(e.region,e.realm,e.character);if(t&&(t.style.display="none"),o&&(_(o.collected,o.possible),k(o,n),e.subcat==="planner")){P(o,l,e);const c=document.getElementById("planner-toggle");c&&(c.checked=!0),l&&(l.style.display="block"),n&&(n.style.display="none")}}catch(o){console.error("Error loading mounts:",o),t&&(t.style.display="none"),a&&(a.style.display="block")}}function _(e,t){const a=document.getElementById("mounts-progress"),n=document.getElementById("mounts-percentage");if(!a||!n)return;const l=$(e,t),o=B(e,t);a.style.width=l+"%",a.setAttribute("aria-valuenow",l.toString()),n.textContent=o}function k(e,t){!t||!e||!e.categories||(t.innerHTML="",e.categories.forEach(a=>{const n=document.createElement("div");n.className="mount-category";const l=document.createElement("h3");l.className="category-header",l.textContent=a.name,n.appendChild(l),a.subcats&&a.subcats.length>0&&a.subcats.forEach(o=>{const c=document.createElement("div");c.className="mount-subcategory";const f=document.createElement("h4");f.className="subcategory-header",f.textContent=o.name,c.appendChild(f);const m=document.createElement("div");m.className="mounts-grid",o.mounts&&o.mounts.length>0&&o.mounts.forEach(s=>{const d=document.createElement("div");d.className=`mount-item ${s.collected?"collected":"not-collected"}`;const h=document.createElement("img");h.src=s.icon?`//wow.zamimg.com/images/wow/icons/small/${s.icon}.jpg`:"",h.alt=s.name,h.title=s.name,d.appendChild(h),d.dataset.mountId=s.id.toString(),d.dataset.mountName=s.name,d.dataset.mountCollected=s.collected.toString(),m.appendChild(d)}),c.appendChild(m),n.appendChild(c)}),t.appendChild(n)}),window.WH&&window.WH.Tooltip&&window.WH.Tooltip.refresh())}async function P(e,t,a){if(!(!t||!e))try{const{getPlannerSteps:n}=await T(async()=>{const{getPlannerSteps:o}=await import("./planner.DciZa9Cb.js");return{getPlannerSteps:o}},[]),l=await n(e,a.region,a.realm,a.character);S(l,t,e.isAlliance)}catch(n){console.error("Error loading planner:",n),t.innerHTML='<div class="error-message">Failed to load planner data.</div>'}}function S(e,t,a){if(!t)return;if(t.innerHTML="",e&&e.length===0){t.innerHTML=`
        <div class="success-message">
          <img src="/images/success.png" alt="Success"/>
          <p>
            Grats! You've farmed all the mounts. <br/>
            You should post on <a href="http://reddit.com/r/wow">/r/wow</a>!
          </p>
        </div>
      `;return}const n=document.createElement("table");n.className="table table-condensed";const l=document.createElement("thead");l.innerHTML=`
      <tr>
        <th>#</th>
        <th>Step</th>
        <th class="mnt-plan-boss-col">Boss</th>
        <th class="mnt-plan-mount-col" style="padding-left:0px;">Mount</th>
        <th>Notes</th>
      </tr>
    `,n.appendChild(l);const o=document.createElement("tbody");e&&e.length>0&&e.forEach((c,f)=>{const m=document.createElement("tr"),s=document.createElement("td");s.textContent=(f+1).toString(),m.appendChild(s);const d=document.createElement("td");if(c.capital){const r=document.createElement("img");r.src=a?"/images/alliance.png":"/images/horde.png",r.className="mnt-icon-step",r.alt="",d.appendChild(r)}else if(c.hearth){const r=document.createElement("img");r.src="/images/hearth.png",r.className="mnt-icon-step",r.alt="",d.appendChild(r)}const h=document.createTextNode(c.capital?`Hearthstone to ${a?"Stormwind ":"Orgrimmar "}${c.title}`:c.title);d.appendChild(h),m.appendChild(d);const w=document.createElement("td");if(w.colSpan=2,c.bosses&&c.bosses.length>0){const r=document.createElement("table");r.width="100%",c.bosses.forEach(i=>{const p=document.createElement("tr"),u=document.createElement("td");u.className="mnt-plan-boss-col",u.textContent=i.name,p.appendChild(u);const y=document.createElement("td");if(y.className="mnt-plan-mount-col",i.itemId){const g=document.createElement("a");if(g.className=i.epic?"mnt-plan-epic":"mnt-plan-rare",g.target="_blank",g.href=`//wowhead.com/item=${i.itemId}`,i.icon){const E=document.createElement("img");E.className="mnt-plan-icon",E.src=`//wow.zamimg.com/images/wow/icons/tiny/${i.icon}.gif`,E.alt="",g.appendChild(E)}g.appendChild(document.createTextNode(i.mount)),y.appendChild(g)}p.appendChild(y),r.appendChild(p)}),w.appendChild(r)}m.appendChild(w);const C=document.createElement("td");if(c.notes&&(C.textContent=c.notes),c.bosses&&c.bosses.length>0){const r=document.createElement("table");c.bosses.forEach(i=>{if(i.note){const p=document.createElement("tr"),u=document.createElement("td");u.textContent=i.note,p.appendChild(u),r.appendChild(p)}else{const p=document.createElement("tr"),u=document.createElement("td");u.innerHTML="&nbsp;",p.appendChild(u),r.appendChild(p)}}),C.appendChild(r)}m.appendChild(C),o.appendChild(m)}),n.appendChild(o),t.appendChild(n),window.WH&&window.WH.Tooltip&&window.WH.Tooltip.refresh()}
